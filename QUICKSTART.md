# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç Veil Xray API

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏

1. ‚úì –ö–ª—é—á–∏ Reality —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã
2. ‚úì –§–∞–π–ª `.env` —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. ‚úì –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
4. ‚úì –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
5. ‚úì API —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- **Reality Keys**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ `/root/config/reality_keys.txt`
- **API Secret Key**: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á –≤ `.env`
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: `/root/database/veil_xray.db` (—Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

## üöÄ –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é

```bash
cd /root
source venv/bin/activate
python3 -m uvicorn api.main:app --host 0.0.0.0 --port 8000
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ systemd

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å unit —Ñ–∞–π–ª
sudo cp scripts/veil-xray-api.service /etc/systemd/system/

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd
sudo systemctl daemon-reload

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl start veil-xray-api

# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable veil-xray-api

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status veil-xray-api
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Xray

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏–∑ `/root/config/reality_keys.txt`
2. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Xray (`/usr/local/etc/xray/config.json`) –≤ —Å–µ–∫—Ü–∏—é `realitySettings.privateKey`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Xray API –≤–∫–ª—é—á–µ–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```json
{
  "api": {
    "tag": "api",
    "services": ["StatsService", "HandlerService"]
  }
}
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Xray:

```bash
sudo systemctl restart xray
```

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ API —Å–µ—Ä–≤–µ—Ä–∞:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API: http://localhost:8000/docs
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞: http://localhost:8000/
3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á:

```bash
curl -X POST "http://localhost:8000/api/keys" \
  -H "Authorization: Bearer $(grep API_SECRET_KEY /root/.env | cut -d'=' -f2)" \
  -H "Content-Type: application/json" \
  -d '{"name": "test_key"}'
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**
- –ò–∑–º–µ–Ω–∏—Ç–µ `API_SECRET_KEY` –≤ `.env` –Ω–∞ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –∫–ª—é—á –¥–ª—è production
- –•—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á Reality –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ API
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS —á–µ—Ä–µ–∑ reverse proxy (Nginx/Caddy)

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `README.md`
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: `TZ.md`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `.env`


